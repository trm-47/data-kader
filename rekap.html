<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Review Data Kader - PDI Perjuangan</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* Penyesuaian khusus slider agar tetap Luxury di rekap */
        .slider-wrapper {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 16px;
            padding: 10px 5px 25px;
            scrollbar-width: none;
        }
        .slider-wrapper::-webkit-scrollbar { display: none; }

        .rekap-card {
            min-width: 88%;
            scroll-snap-align: center;
            background: white;
            padding: 24px;
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
            max-height: 65vh;
            overflow-y: auto;
            position: relative;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-box {
            background: #f8fafc;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .rekap-card::before {
            content: "";
            position: absolute;
            bottom: -20px;
            right: -20px;
            width: 150px;
            height: 150px;
            background: url('https://i.ibb.co.com/N2K0XRMW/logo-pdi.png') no-repeat;
            background-size: contain;
            opacity: 0.03;
            z-index: 0;
        }

        /* Divider Sultan */
        .rekap-divider {
            border: 0;
            height: 1px;
            background: linear-gradient(to right, transparent, #eee, transparent);
            margin: 20px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-form" style="text-align: center;">
        <img src="https://i.ibb.co.com/N2K0XRMW/logo-pdi.png" alt="Logo" class="logo-small">
        <h2>Review Data Anda</h2>
        <p class="subtitle">Geser kartu untuk memastikan akurasi data</p>
    </div>

    <div class="slider-wrapper" id="rekapSlider">
        <div class="rekap-card">
            <div class="section-title">
                <span>1. Profil Pribadi</span>
                <a href="step1.html" class="edit-link">EDIT</a>
            </div>
            <div id="fotoPreviewRekap" style="text-align: center; margin-bottom: 20px;"></div>
            <div id="rekapPribadi"></div>
        </div>

        <div class="rekap-card">
            <div class="section-title">
                <span>2. Pendidikan Formal</span>
                <a href="step2.html" class="edit-link">EDIT</a>
            </div>
            <div id="rekapFormal"></div>
        </div>

        <div class="rekap-card">
            <div class="section-title">
                <span>3. Kaderisasi</span>
                <a href="step3.html" class="edit-link">EDIT</a>
            </div>
            <div id="rekapKader"></div>
        </div>

        <div class="rekap-card">
            <div class="section-title">
                <span>4. Jabatan & Kerja</span>
                <a href="step4.html" class="edit-link">EDIT</a>
            </div>
<h4 style="font-size: 10px; color: #94a3b8; letter-spacing: 1px; margin: 15px 0 8px; font-weight: 800; text-transform: uppercase;">
    üö© Struktur Partai
</h4>
<div id="rekapJabatanPartai"></div>

<h4 style="font-size: 10px; color: #94a3b8; letter-spacing: 1px; margin: 20px 0 8px; font-weight: 800; text-transform: uppercase;">
    üíº Pengalaman Kerja
</h4>
<div id="rekapPekerjaan"></div>
        </div>

        <div class="rekap-card">
            <div class="section-title">
                <span>5. Organisasi & Medsos</span>
                <a href="step6.html" class="edit-link">EDIT</a>
            </div>
            
            <h4 style="font-size: 11px; color: var(--soft-slate); margin: 0 0 10px;">ORGANISASI NON-PARTAI</h4>
            <div id="rekapOrganisasi"></div>
            
            <hr class="rekap-divider">
            
            <h4 style="font-size: 11px; color: var(--soft-slate); margin: 0 0 10px;">SKILL & MEDIA SOSIAL</h4>
            <div id="rekapLainnya"></div>
        </div>
    </div>

    <div class="nav-slider" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
        <button onclick="slide('left')" class="btn-outline-sm">‚¨ÖÔ∏è Prev</button>
        <button onclick="slide('right')" class="btn-outline-sm">Next ‚û°Ô∏è</button>
    </div>

    <div style="padding: 0 5px;">
        <p style="font-size: 12px; color: #ef4444; text-align: center; margin-bottom: 15px; font-weight: 600;">
            * Pastikan semua data sudah benar sebelum dikirim ke pusat.
        </p>
        <button onclick="submitSeluruhData()" class="btn-final">KIRIM DATA SEKARANG</button>
        <button onclick="window.history.back()" class="btn-outline-sm" style="width: 100%; margin-top: 10px;">Cek Kembali</button>
    </div>
</div>

<script src="script.js"></script>
<script>
    window.addEventListener('load', loadRekapitulasi);

    function slide(direction) {
        const slider = document.getElementById('rekapSlider');
        const scrollAmount = slider.offsetWidth * 0.9;
        slider.scrollBy({ left: direction === 'left' ? -scrollAmount : scrollAmount, behavior: 'smooth' });
    }

    function loadRekapitulasi() {
        const data = JSON.parse(localStorage.getItem('kaderData')) || {};
        
        // 1. Render Foto
        if (data.foto) {
            document.getElementById('fotoPreviewRekap').innerHTML = `
                <img src="${data.foto}" style="width:110px; height:110px; border-radius:20px; object-fit:cover; border: 4px solid white; box-shadow: 0 10px 20px rgba(0,0,0,0.1);">`;
        }

        // 2. Render Data Pribadi (Premium Grid)
        const pribadiFields = {
            'Nama Lengkap': data.nama_lengkap,
            'NIK': data.nik,
            'No. KTA': data.no_kta || '-',
            'Jenis Kelamin': data.jenis_kelamin,
            'Kontak/WA': data.kontak,
            'Pekerjaan': data.pekerjaan,
            'Alamat': `${data.alamat || '-'}, RT ${data.rt || '0'}/RW ${data.rw || '0'}`,
            'Wilayah': `${data.kelurahan || '-'}, ${data.kecamatan || '-'}, ${data.kab_kota || '-'}`
        };

        let htmlPribadi = '<div class="rekap-grid">';
        Object.entries(pribadiFields).forEach(([label, val]) => {
            htmlPribadi += `
                <div class="rekap-item-premium">
                    <div class="rekap-label">${label}</div>
                    <div class="rekap-value">${val || '-'}</div>
                </div>`;
        });
        htmlPribadi += '</div>';
        document.getElementById('rekapPribadi').innerHTML = htmlPribadi;

        // 3. Render Pendidikan Formal
        document.getElementById('rekapFormal').innerHTML = data.riwayat_pendidikan?.length 
            ? data.riwayat_pendidikan.map(p => `<div class="data-box"><b>${p.jenjang}: ${p.nama}</b><br><span style="font-size:11px;">${p.info || ''} | ${p.kota || ''} (${p.tahun || ''})</span></div>`).join('') 
            : '<p style="color:gray; font-size:12px;">Tidak ada data.</p>';

        // 4. Render Pendidikan Kader
        document.getElementById('rekapKader').innerHTML = data.riwayat_kader?.length 
            ? data.riwayat_kader.map(k => `<div class="data-box" style="border-left-color: #D71920;"><b>Kader ${k.jenis}</b><br><span style="font-size:11px;">${k.penyelenggara} (${k.tahun})</span></div>`).join('') 
            : '<p style="color:gray; font-size:12px;">Tidak ada data.</p>';

// 5. Render Organisasi (Menampilkan Nama & Tingkatan)
const orgData = data.riwayat_organisasi || [];
document.getElementById('rekapOrganisasi').innerHTML = orgData.length 
    ? orgData.map(o => `
        <div class="data-box" style="border-left-color: #2563eb; background: #f0f9ff;">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <b style="color: #1e40af; font-size: 13px;">${o.nama}</b>
                <span style="font-size: 9px; background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 4px; font-weight: 800; text-transform: uppercase;">
                    ${o.tingkat || 'Lokal'}
                </span>
            </div>
            <div style="font-size: 11px; color: #475569; margin-top: 4px;">
                ${o.jabatan} <span style="color: #cbd5e1; margin: 0 5px;">|</span> ${o.periode}
            </div>
        </div>`).join('')
    : '<p style="color:gray; font-size:12px; text-align:center;">Tidak ada riwayat organisasi.</p>';

// 6. Render Jabatan & Kerja
const jPartai = data.riwayat_jabatan_partai || [];
const jTugas = data.riwayat_penugasan_partai || []; // Data Baru
const jKerja = data.riwayat_pekerjaan || [];

// Render Struktur Partai (Termasuk Tingkatan)
document.getElementById('rekapJabatanPartai').innerHTML = jPartai.length 
    ? jPartai.map(j => `
        <div class="data-box" style="border-left-color: var(--primary-color);">
            <div style="font-size: 11px; font-weight: 700; color: #ef4444;">${j.tingkatan}</div>
            <div style="font-size: 13px; font-weight: 800; color: #1e293b;">${j.jabatan} ${j.bidang ? '- ' + j.bidang : ''}</div>
            <div style="font-size: 11px; color: #64748b;">Periode: ${j.periode}</div>
        </div>`).join('') 
    : '-';

// Tambahkan Render Penugasan Partai di bawah Jabatan Partai
const htmlPenugasan = jTugas.length 
    ? jTugas.map(t => `
        <div class="data-box" style="border-left-color: #f59e0b; background: #fffbeb;">
            <div style="font-size: 11px; font-weight: 700; color: #d97706;">${t.jenis} ${t.lembaga ? '('+t.lembaga+')' : ''}</div>
            <div style="font-size: 13px; font-weight: 800; color: #1e293b;">${t.jabatan}</div>
            <div style="font-size: 11px; color: #64748b;">Wilayah: ${t.lokasi} | ${t.periode}</div>
        </div>`).join('')
    : '';

// Masukkan ke wadah (Pastikan di HTML rekap ada div id="rekapPenugasan" atau gabungkan saja)
document.getElementById('rekapJabatanPartai').innerHTML += jTugas.length ? '<h4 style="font-size: 10px; color: #94a3b8; margin: 15px 0 5px;">PENUGASAN KHUSUS</h4>' + htmlPenugasan : '';

// Render Pengalaman Kerja
document.getElementById('rekapPekerjaan').innerHTML = jKerja.length 
    ? jKerja.map(p => `<div class="data-box" style="border-left-color: #64748b;"><b>${p.perusahaan}</b><br><span style="font-size:11px;">${p.jabatan}</span></div>`).join('') 
    : '-';

// Render Pengalaman Kerja
document.getElementById('rekapPekerjaan').innerHTML = jKerja.length 
    ? jKerja.map(p => `
        <div class="data-box" style="border-left-color: #64748b; background: #f8fafc;">
            <div style="font-size: 13px; font-weight: 800; color: #1e293b;">${p.perusahaan}</div>
            <div style="font-size: 12px; font-weight: 600; color: #475569; margin-top: 2px;">${p.jabatan}</div>
            <div style="font-size: 10px; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px;">
                üíº Profesional Record
            </div>
        </div>`).join('') 
    : '<p style="color:gray; font-size:12px;">Tidak ada riwayat pekerjaan.</p>';

        // 7. Render Lainnya & Medsos (Logo Media Sosial Asli)
const ms = data.media_sosial || {};

// Link Logo Asli (High Quality PNG)
const icons = {
    fb: "https://cdn-icons-png.flaticon.com/512/124/124010.png",
    ig: "https://cdn-icons-png.flaticon.com/512/174/174855.png",
    tt: "https://cdn-icons-png.flaticon.com/512/3046/3046121.png",
    tw: "https://cdn-icons-png.flaticon.com/512/5968/5968830.png", // X Logo
    yt: "https://cdn-icons-png.flaticon.com/512/1384/1384060.png",
    li: "https://cdn-icons-png.flaticon.com/512/174/174857.png"
};

document.getElementById('rekapLainnya').innerHTML = `
    <div class="rekap-grid">
        <div class="rekap-item-premium">
            <div class="rekap-label">Bahasa</div>
            <div class="rekap-value">${data.kompetensi_bahasa || '-'}</div>
        </div>
        <div class="rekap-item-premium">
            <div class="rekap-label">Komputer</div>
            <div class="rekap-value">${data.kemampuan_komputer || '-'}</div>
        </div>
        
        <div class="rekap-item-premium" style="grid-column: span 2;">
            <div class="rekap-label" style="margin-bottom:10px;">Media Sosial</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                
                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.ig}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.instagram || '-'}</span>
                </div>
                
                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.tt}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.tiktok || '-'}</span>
                </div>

                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.fb}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.facebook || '-'}</span>
                </div>

                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.tw}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.twitter_x || '-'}</span>
                </div>

                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.yt}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.youtube || '-'}</span>
                </div>

                <div style="display: flex; align-items: center; gap: 8px;">
                    <img src="${icons.li}" style="width:18px; height:18px;">
                    <span style="font-size:12px; color:#475569;">${ms.linkedin || '-'}</span>
                </div>

            </div>
        </div>
    </div>`;
    }

    async function submitSeluruhData() {
        // Efek loading simpel
        const btn = event.target;
        btn.disabled = true;
        btn.innerHTML = "Mengirim...";
        
        // Di sini nantinya fungsi kirim ke Google Sheets Bos
        setTimeout(() => {
            alert("Merdeka! Seluruh data berhasil dikirim.");
            btn.innerHTML = "TERKIRIM ‚úÖ";
        }, 2000);
    }
</script>
</body>
</html>
