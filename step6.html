<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tahap Terakhir - Form Kader</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
    <div class="progress-container">
        <div class="progress-bar" style="width: 100%"></div>
    </div>

    <div class="form-card">
        <div class="header-form">
            <img src="https://i.ibb.co.com/N2K0XRMW/logo-pdi.png" alt="Logo PDI Perjuangan" class="logo-small">
            <div>
                <h2>Tahap Terakhir</h2>
            </div>
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Riwayat Organisasi Kemasyarakatan</h3>
        <div class="input-group">
            <input type="text" id="org_nama" placeholder="Nama Organisasi (NU, Muhammadiyah, dll)" class="input-field">
            <input type="text" id="org_jabatan" placeholder="Jabatan" class="input-field" style="margin-top:8px;">
            <input type="text" id="org_periode" placeholder="Periode (Contoh: 2020-2023)" class="input-field" style="margin-top:8px;">
            <button type="button" onclick="addOrganisasi()" class="btn-outline-sm" style="width:100%; margin-top:8px;">âž• Tambah Organisasi</button>
        </div>
        <div id="orgList" style="margin-bottom: 20px;"></div>

        <hr style="border: 0.5px solid #eee; margin: 20px 0;">

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Kompetensi Bahasa</h3>
        <div class="input-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <label><input type="checkbox" name="bahasa" value="Indonesia"> Indonesia</label>
            <label><input type="checkbox" name="bahasa" value="Inggris"> Inggris</label>
            <label><input type="checkbox" name="bahasa" value="Mandarin"> Mandarin</label>
            <label><input type="checkbox" name="bahasa" value="Jawa"> Jawa</label>
        </div>
        <div class="input-group">
            <label>Bahasa Lainnya:</label>
            <input type="text" id="bahasa_lainnya" placeholder="Sebutkan bahasa lain..." class="input-field">
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Kemampuan Komputer</h3>
        <div class="input-group">
            <select id="komputer" class="input-field">
                <option value="Bisa">Bisa (Office, Internet, dll)</option>
                <option value="Tidak Bisa">Tidak Bisa</option>
            </select>
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Akun Media Sosial & Profesional</h3>
        <div class="input-group">
            <input type="text" id="medsos_fb" placeholder="Link/Nama Facebook" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_ig" placeholder="Username Instagram" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_tiktok" placeholder="Username TikTok" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_twitter" placeholder="Username Twitter (X)" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_youtube" placeholder="Nama/Link Channel YouTube" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_linkedin" placeholder="Link Profil LinkedIn" class="input-field">
        </div>

        <div class="nav-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="window.location.href='step5.html'" class="btn-outline-sm" style="flex: 1;">Kembali</button>
            <button onclick="goToReview()" class="btn-primary" style="flex: 1; background: #2563eb; border-color: #2563eb;">Review Data</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    window.addEventListener('load', () => {
        // 1. Render List Organisasi (panggil fungsi dari script.js)
        if (typeof renderOrganisasi === 'function') renderOrganisasi();

        // 2. Auto-Fill data yang sudah tersimpan sebelumnya
        const savedData = JSON.parse(localStorage.getItem('kaderData'));
        if (savedData) {
            // Load Medsos
            if (savedData.media_sosial) {
                document.getElementById('medsos_fb').value = savedData.media_sosial.facebook !== '-' ? savedData.media_sosial.facebook : '';
                document.getElementById('medsos_ig').value = savedData.media_sosial.instagram !== '-' ? savedData.media_sosial.instagram : '';
                document.getElementById('medsos_tiktok').value = savedData.media_sosial.tiktok !== '-' ? savedData.media_sosial.tiktok : '';
                document.getElementById('medsos_twitter').value = savedData.media_sosial.twitter_x !== '-' ? savedData.media_sosial.twitter_x : '';
                document.getElementById('medsos_youtube').value = savedData.media_sosial.youtube !== '-' ? savedData.media_sosial.youtube : '';
                document.getElementById('medsos_linkedin').value = savedData.media_sosial.linkedin !== '-' ? savedData.media_sosial.linkedin : '';
            }

            // Load Checkbox Bahasa
            if (savedData.kompetensi_bahasa) {
                const bahasaArray = savedData.kompetensi_bahasa.split(', ');
                const checkboxes = document.querySelectorAll('input[name="bahasa"]');
                checkboxes.forEach(cb => {
                    if (bahasaArray.includes(cb.value)) cb.checked = true;
                });
            }

            // Load Inputan Lainnya
            if (savedData.bahasa_lainnya_input) document.getElementById('bahasa_lainnya').value = savedData.bahasa_lainnya_input;
            if (savedData.kemampuan_komputer) document.getElementById('komputer').value = savedData.kemampuan_komputer;
        }
    });

    function goToReview() {
        try {
            // Ambil data lama biar gak nimpa data dari Step 1-5
            let data = JSON.parse(localStorage.getItem('kaderData')) || {};

            // 1. Ambil Bahasa
            const checkboxes = document.querySelectorAll('input[name="bahasa"]:checked');
            let bahasaList = Array.from(checkboxes).map(cb => cb.value);
            const lainnya = document.getElementById('bahasa_lainnya').value.trim();
            
            // Simpan input mentah "lainnya" buat kebutuhan auto-fill nanti
            data.bahasa_lainnya_input = lainnya; 
            if(lainnya) bahasaList.push(lainnya);

            data.kompetensi_bahasa = bahasaList.length > 0 ? bahasaList.join(', ') : '-';
            data.kemampuan_komputer = document.getElementById('komputer').value;

            // 2. Ambil Medsos (Simpan "-" kalau kosong)
            data.media_sosial = {
                facebook: document.getElementById('medsos_fb').value.trim() || '-',
                instagram: document.getElementById('medsos_ig').value.trim() || '-',
                tiktok: document.getElementById('medsos_tiktok').value.trim() || '-',
                twitter_x: document.getElementById('medsos_twitter').value.trim() || '-',
                youtube: document.getElementById('medsos_youtube').value.trim() || '-',
                linkedin: document.getElementById('medsos_linkedin').value.trim() || '-'
            };

            // 3. Simpan & Pindah Halaman
            localStorage.setItem('kaderData', JSON.stringify(data));
            
            // Debugging (bisa dihapus kalau sudah oke)
            console.log("Data tersimpan, pindah ke rekap...");
            
            window.location.href = 'rekap.html';
            
        } catch (error) {
            console.error("Error Detail:", error);
            alert("Terjadi kesalahan saat menyimpan. Pastikan fitur LocalStorage browser aktif.");
        }
    }
</script>
</body>
</html>
