<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tahap Terakhir - Form Kader</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
    <div class="progress-container">
        <div class="progress-bar" style="width: 100%"></div>
    </div>

    <div class="form-card">
        <div class="header-form">
            <img src="https://i.ibb.co.com/N2K0XRMW/logo-pdi.png" alt="Logo PDI Perjuangan" class="logo-small">
            <div>
                <h2>Tahap Terakhir</h2>
            </div>
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Riwayat Organisasi Kemasyarakatan</h3>
        <div class="input-group">
            <input type="text" id="org_nama" placeholder="Nama Organisasi (NU, Muhammadiyah, dll)" class="input-field">
            
            <select id="org_tingkat" class="input-field" style="margin-top:8px;">
                <option value="">-- Pilih Tingkatan --</option>
                <option value="Pusat / Nasional">Pusat / Nasional</option>
                <option value="Provinsi">Provinsi</option>
                <option value="Kabupaten / Kota">Kabupaten / Kota</option>
                <option value="Kecamatan / Lokal">Kecamatan / Lokal</option>
            </select>

            <input type="text" id="org_jabatan" placeholder="Jabatan" class="input-field" style="margin-top:8px;">
            <input type="text" id="org_periode" placeholder="Periode (Contoh: 2020-2023)" class="input-field" style="margin-top:8px;">
            <button type="button" onclick="addOrganisasi()" class="btn-outline-sm" style="width:100%; margin-top:8px;">➕ Tambah Organisasi</button>
        </div>
        <div id="orgList" style="margin-bottom: 20px;"></div>

        <hr style="border: 0.5px solid #eee; margin: 20px 0;">

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Kompetensi Bahasa</h3>
        <div class="input-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <label><input type="checkbox" name="bahasa" value="Indonesia"> Indonesia</label>
            <label><input type="checkbox" name="bahasa" value="Inggris"> Inggris</label>
            <label><input type="checkbox" name="bahasa" value="Mandarin"> Mandarin</label>
            <label><input type="checkbox" name="bahasa" value="Jawa"> Jawa</label>
        </div>
        <div class="input-group">
            <label>Bahasa Lainnya:</label>
            <input type="text" id="bahasa_lainnya" placeholder="Sebutkan bahasa lain..." class="input-field">
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Kemampuan Komputer</h3>
        <div class="input-group">
            <select id="komputer" class="input-field">
                <option value="Bisa">Bisa (Office, Internet, dll)</option>
                <option value="Tidak Bisa">Tidak Bisa</option>
            </select>
        </div>

        <h3 style="font-size: 14px; margin-bottom: 10px; color: var(--primary-color);">Akun Media Sosial & Profesional</h3>
        <div class="input-group">
            <input type="text" id="medsos_fb" placeholder="Link/Nama Facebook" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_ig" placeholder="Username Instagram" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_tiktok" placeholder="Username TikTok" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_twitter" placeholder="Username Twitter (X)" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_youtube" placeholder="Nama/Link Channel YouTube" class="input-field" style="margin-bottom:8px;">
            <input type="text" id="medsos_linkedin" placeholder="Link Profil LinkedIn" class="input-field">
        </div>

        <div class="nav-buttons" style="display: flex; gap: 10px; margin-top: 20px;">
            <button onclick="window.location.href='step5.html'" class="btn-outline-sm" style="flex: 1;">Kembali</button>
            <button onclick="goToReview()" class="btn-primary" style="flex: 1; background: #2563eb; border-color: #2563eb;">Review Data</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    // FUNGSI TAMBAH ORGANISASI DENGAN TINGKATAN
    function addOrganisasi() {
        const nama = document.getElementById('org_nama').value.trim();
        const tingkat = document.getElementById('org_tingkat').value;
        const jabatan = document.getElementById('org_jabatan').value.trim();
        const periode = document.getElementById('org_periode').value.trim();

        if (!nama || !tingkat || !jabatan) {
            alert("Nama, Tingkatan, dan Jabatan wajib diisi!");
            return;
        }

        let data = JSON.parse(localStorage.getItem('kaderData')) || {};
        if (!data.riwayat_organisasi) data.riwayat_organisasi = [];

        // Simpan data tingkatan ke dalam array
        data.riwayat_organisasi.push({
            nama: nama,
            tingkat: tingkat,
            jabatan: jabatan,
            periode: periode || '-'
        });

        localStorage.setItem('kaderData', JSON.stringify(data));
        
        // Reset field input
        document.getElementById('org_nama').value = '';
        document.getElementById('org_tingkat').value = '';
        document.getElementById('org_jabatan').value = '';
        document.getElementById('org_periode').value = '';

        renderOrganisasi();
    }

    // FUNGSI RENDER LIST ORGANISASI
    function renderOrganisasi() {
        const data = JSON.parse(localStorage.getItem('kaderData')) || {};
        const orgList = document.getElementById('orgList');
        if (!orgList) return;

        const items = data.riwayat_organisasi || [];
        orgList.innerHTML = items.map((org, index) => `
            <div style="background: #f8fafc; padding: 10px; border-radius: 8px; margin-top: 8px; border-left: 3px solid #2563eb; position: relative;">
                <div style="font-size: 12px; font-weight: 700; color: #1e40af;">${org.nama} (${org.tingkat})</div>
                <div style="font-size: 11px; color: #475569;">${org.jabatan} | ${org.periode}</div>
                <button onclick="deleteOrganisasi(${index})" style="position: absolute; right: 10px; top: 10px; border: none; background: none; color: #ef4444; cursor: pointer;">❌</button>
            </div>
        `).join('');
    }

    function deleteOrganisasi(index) {
        let data = JSON.parse(localStorage.getItem('kaderData'));
        data.riwayat_organisasi.splice(index, 1);
        localStorage.setItem('kaderData', JSON.stringify(data));
        renderOrganisasi();
    }

    window.addEventListener('load', () => {
        renderOrganisasi();

        const savedData = JSON.parse(localStorage.getItem('kaderData'));
        if (savedData) {
            // ... Load data Medsos, Bahasa, Komputer ... (Kode sama seperti sebelumnya)
            if (savedData.media_sosial) {
                document.getElementById('medsos_fb').value = savedData.media_sosial.facebook !== '-' ? savedData.media_sosial.facebook : '';
                document.getElementById('medsos_ig').value = savedData.media_sosial.instagram !== '-' ? savedData.media_sosial.instagram : '';
                document.getElementById('medsos_tiktok').value = savedData.media_sosial.tiktok !== '-' ? savedData.media_sosial.tiktok : '';
                document.getElementById('medsos_twitter').value = savedData.media_sosial.twitter_x !== '-' ? savedData.media_sosial.twitter_x : '';
                document.getElementById('medsos_youtube').value = savedData.media_sosial.youtube !== '-' ? savedData.media_sosial.youtube : '';
                document.getElementById('medsos_linkedin').value = savedData.media_sosial.linkedin !== '-' ? savedData.media_sosial.linkedin : '';
            }

            if (savedData.kompetensi_bahasa) {
                const bahasaArray = savedData.kompetensi_bahasa.split(', ');
                const checkboxes = document.querySelectorAll('input[name="bahasa"]');
                checkboxes.forEach(cb => {
                    if (bahasaArray.includes(cb.value)) cb.checked = true;
                });
            }

            if (savedData.bahasa_lainnya_input) document.getElementById('bahasa_lainnya').value = savedData.bahasa_lainnya_input;
            if (savedData.kemampuan_komputer) document.getElementById('komputer').value = savedData.kemampuan_komputer;
        }
    });


function goToReview() {
    try {
        let data = JSON.parse(localStorage.getItem('kaderData')) || {};

        // 1. Ambil Kompetensi Bahasa & Komputer
        const checkboxes = document.querySelectorAll('input[name="bahasa"]:checked');
        data.kompetensi_bahasa = Array.from(checkboxes).map(cb => cb.value).join(', ') || '-';
        data.bahasa_lainnya_input = document.getElementById('bahasa_lainnya')?.value || '';
        data.kemampuan_komputer = document.getElementById('komputer')?.value || '-';

        // 2. Ambil Akun Media Sosial (Sesuai ID di HTML Step 6 Bos)
        data.media_sosial = {
            facebook: document.getElementById('medsos_fb')?.value.trim() || '-',
            instagram: document.getElementById('medsos_ig')?.value.trim() || '-',
            tiktok: document.getElementById('medsos_tiktok')?.value.trim() || '-',
            twitter_x: document.getElementById('medsos_twitter')?.value.trim() || '-',
            youtube: document.getElementById('medsos_youtube')?.value.trim() || '-',
            linkedin: document.getElementById('medsos_linkedin')?.value.trim() || '-'
        };

        // 3. Simpan dan Lanjut
        localStorage.setItem('kaderData', JSON.stringify(data));
        window.location.href = 'rekap.html';

    } catch (error) {
        console.error("Error Step 6:", error);
        alert("Gagal menyimpan data Step 6, Bos.");
    }
}

// Tetap sediakan saveStep6 jika ada tombol yang memanggil nama lama
function saveStep6() {
    goToReview();
}
</script>
</body>
</html>
